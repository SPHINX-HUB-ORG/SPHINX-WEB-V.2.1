{"version":3,"file":"index.es.js","sources":["../../../../node_modules/is-hotkey/lib/index.js","../src/transforms/wrapLink.ts","../src/transforms/upsertLinkAtSelection.ts","../src/transforms/getAndUpsertLink.ts","../src/onKeyDownLink.ts","../src/withLink.ts","../src/createLinkPlugin.ts"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n/**\n * Constants.\n */\n\n// We make this a function so it can be tested in describe block mocks with Jest.\nvar IS_MAC = () => typeof window != 'undefined' && /Mac|iPod|iPhone|iPad/.test(window.navigator.platform);\n\nvar MODIFIERS = {\n  alt: 'altKey',\n  control: 'ctrlKey',\n  meta: 'metaKey',\n  shift: 'shiftKey'\n};\n\n// We make this a function so it can be tested in describe block mocks with Jest.\nvar ALIASES = () => ({\n  add: '+',\n  break: 'pause',\n  cmd: 'meta',\n  command: 'meta',\n  ctl: 'control',\n  ctrl: 'control',\n  del: 'delete',\n  down: 'arrowdown',\n  esc: 'escape',\n  ins: 'insert',\n  left: 'arrowleft',\n  mod: IS_MAC() ? 'meta' : 'control',\n  opt: 'alt',\n  option: 'alt',\n  return: 'enter',\n  right: 'arrowright',\n  space: ' ',\n  spacebar: ' ',\n  up: 'arrowup',\n  win: 'meta',\n  windows: 'meta'\n});\n\nvar CODES = {\n  backspace: 8,\n  tab: 9,\n  enter: 13,\n  shift: 16,\n  control: 17,\n  alt: 18,\n  pause: 19,\n  capslock: 20,\n  escape: 27,\n  ' ': 32,\n  pageup: 33,\n  pagedown: 34,\n  end: 35,\n  home: 36,\n  arrowleft: 37,\n  arrowup: 38,\n  arrowright: 39,\n  arrowdown: 40,\n  insert: 45,\n  delete: 46,\n  meta: 91,\n  numlock: 144,\n  scrolllock: 145,\n  ';': 186,\n  '=': 187,\n  ',': 188,\n  '-': 189,\n  '.': 190,\n  '/': 191,\n  '`': 192,\n  '[': 219,\n  '\\\\': 220,\n  ']': 221,\n  '\\'': 222\n};\n\nfor (var f = 1; f < 20; f++) {\n  CODES['f' + f] = 111 + f;\n}\n\n/**\n * Is hotkey?\n */\n\nfunction isHotkey(hotkey, options, event) {\n  if (options && !('byKey' in options)) {\n    event = options;\n    options = null;\n  }\n\n  if (!Array.isArray(hotkey)) {\n    hotkey = [hotkey];\n  }\n\n  var array = hotkey.map(function (string) {\n    return parseHotkey(string, options);\n  });\n  var check = function check(e) {\n    return array.some(function (object) {\n      return compareHotkey(object, e);\n    });\n  };\n  var ret = event == null ? check : check(event);\n  return ret;\n}\n\nfunction isCodeHotkey(hotkey, event) {\n  return isHotkey(hotkey, event);\n}\n\nfunction isKeyHotkey(hotkey, event) {\n  return isHotkey(hotkey, { byKey: true }, event);\n}\n\n/**\n * Parse.\n */\n\nfunction parseHotkey(hotkey, options) {\n  var byKey = options && options.byKey;\n  var ret = {};\n\n  // Special case to handle the `+` key since we use it as a separator.\n  hotkey = hotkey.replace('++', '+add');\n  var values = hotkey.split('+');\n  var length = values.length;\n\n  // Ensure that all the modifiers are set to false unless the hotkey has them.\n\n  for (var k in MODIFIERS) {\n    ret[MODIFIERS[k]] = false;\n  }\n\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = values[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var value = _step.value;\n\n      var optional = value.endsWith('?') && value.length > 1;\n\n      if (optional) {\n        value = value.slice(0, -1);\n      }\n\n      var name = toKeyName(value);\n      var modifier = MODIFIERS[name];\n\n      if (length === 1 || !modifier) {\n        if (byKey) {\n          ret.key = name;\n        } else {\n          ret.which = toKeyCode(value);\n        }\n      }\n\n      if (modifier) {\n        ret[modifier] = optional ? null : true;\n      }\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return ret;\n}\n\n/**\n * Compare.\n */\n\nfunction compareHotkey(object, event) {\n  for (var key in object) {\n    var expected = object[key];\n    var actual = void 0;\n\n    if (expected == null) {\n      continue;\n    }\n\n    if (key === 'key' && event.key != null) {\n      actual = event.key.toLowerCase();\n    } else if (key === 'which') {\n      actual = expected === 91 && event.which === 93 ? 91 : event.which;\n    } else {\n      actual = event[key];\n    }\n\n    if (actual == null && expected === false) {\n      continue;\n    }\n\n    if (actual !== expected) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Utils.\n */\n\nfunction toKeyCode(name) {\n  name = toKeyName(name);\n  var code = CODES[name] || name.toUpperCase().charCodeAt(0);\n  return code;\n}\n\nfunction toKeyName(name) {\n  name = name.toLowerCase();\n  name = ALIASES()[name] || name;\n  return name;\n}\n\n/**\n * Export.\n */\n\nexports.default = isHotkey;\nexports.isHotkey = isHotkey;\nexports.isCodeHotkey = isCodeHotkey;\nexports.isKeyHotkey = isKeyHotkey;\nexports.parseHotkey = parseHotkey;\nexports.compareHotkey = compareHotkey;\nexports.toKeyCode = toKeyCode;\nexports.toKeyName = toKeyName;","import {\n  getPluginType,\n  PlateEditor,\n  Value,\n  wrapNodes,\n} from '@udecode/plate-core';\nimport { Location } from 'slate';\nimport { ELEMENT_LINK } from '../createLinkPlugin';\nimport { TLinkElement } from '../types';\n\n/**\n * Wrap selected nodes with a link and collapse at the end.\n */\nexport const wrapLink = <V extends Value>(\n  editor: PlateEditor<V>,\n  { at, url }: { url: string; at?: Location }\n) => {\n  wrapNodes<TLinkElement>(\n    editor,\n    {\n      type: getPluginType(editor, ELEMENT_LINK),\n      url,\n      children: [],\n    },\n    { at, split: true }\n  );\n};\n","import {\n  collapseSelection,\n  getLeafNode,\n  getPluginType,\n  insertNodes,\n  isCollapsed,\n  PlateEditor,\n  select,\n  unwrapNodes,\n  Value,\n} from '@udecode/plate-core';\nimport { ELEMENT_LINK } from '../createLinkPlugin';\nimport { TLinkElement } from '../types';\nimport { wrapLink } from './wrapLink';\n\n/**\n * Unwrap link at a location (default: selection).\n * Then, the focus of the location is set to selection focus.\n * Then, wrap the link at the location.\n */\nexport const upsertLinkAtSelection = <V extends Value>(\n  editor: PlateEditor<V>,\n  {\n    url,\n    wrap,\n  }: {\n    url: string;\n    /**\n     * If true, wrap the link at the location (default: selection) even if the selection is collapsed.\n     */\n    wrap?: boolean;\n  }\n) => {\n  if (!editor.selection) return;\n\n  const type = getPluginType(editor, ELEMENT_LINK);\n\n  if (!wrap && isCollapsed(editor.selection)) {\n    return insertNodes<TLinkElement>(editor, {\n      type,\n      url,\n      children: [{ text: url }],\n    });\n  }\n\n  // if our cursor is inside an existing link, but don't have the text selected, select it now\n  if (wrap && isCollapsed(editor.selection)) {\n    const linkLeaf = getLeafNode(editor, editor.selection);\n    const [, inlinePath] = linkLeaf;\n    select(editor, inlinePath);\n  }\n\n  unwrapNodes(editor, { at: editor.selection, match: { type } });\n\n  wrapLink(editor, { at: editor.selection, url });\n\n  collapseSelection(editor, { edge: 'end' });\n};\n","import {\n  getAboveNode,\n  getPluginType,\n  isCollapsed,\n  PlateEditor,\n  unwrapNodes,\n  Value,\n} from '@udecode/plate-core';\nimport { ELEMENT_LINK } from '../createLinkPlugin';\nimport { LinkPlugin } from '../types';\nimport { upsertLinkAtSelection } from './upsertLinkAtSelection';\n\nexport const getAndUpsertLink = async <V extends Value>(\n  editor: PlateEditor<V>,\n  getLinkUrl?: LinkPlugin['getLinkUrl']\n) => {\n  const type = getPluginType(editor, ELEMENT_LINK);\n  let prevUrl = '';\n\n  const linkNode = getAboveNode(editor, {\n    match: { type },\n  });\n  if (linkNode) {\n    prevUrl = linkNode[0].url as string;\n  }\n\n  let url;\n  if (getLinkUrl) {\n    url = await getLinkUrl(prevUrl);\n  } else {\n    url = window.prompt(`Enter the URL of the link:`, prevUrl);\n  }\n\n  if (!url) {\n    linkNode &&\n      editor.selection &&\n      unwrapNodes(editor, {\n        at: editor.selection,\n        match: { type: getPluginType(editor, ELEMENT_LINK) },\n      });\n\n    return;\n  }\n\n  // If our cursor is in middle of a link, then we don't want to insert it inline\n  const shouldWrap: boolean =\n    linkNode !== undefined && isCollapsed(editor.selection);\n  upsertLinkAtSelection(editor, { url, wrap: shouldWrap });\n};\n","import {\n  KeyboardHandlerReturnType,\n  PlateEditor,\n  Value,\n  WithPlatePlugin,\n} from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\nimport { getAndUpsertLink } from './transforms';\nimport { LinkPlugin } from './types';\n\nexport const onKeyDownLink = <\n  V extends Value = Value,\n  E extends PlateEditor<V> = PlateEditor<V>\n>(\n  editor: E,\n  { options: { getLinkUrl, hotkey } }: WithPlatePlugin<LinkPlugin, V, E>\n): KeyboardHandlerReturnType => (e) => {\n  if (!hotkey) return;\n\n  if (isHotkey(hotkey, e as any)) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    getAndUpsertLink(editor, getLinkUrl);\n  }\n};\n","import {\n  getEditorString,\n  getPluginType,\n  getRangeBefore,\n  getRangeFromBlockStart,\n  isCollapsed,\n  mockPlugin,\n  moveSelection,\n  PlateEditor,\n  someNode,\n  unwrapNodes,\n  Value,\n  WithPlatePlugin,\n} from '@udecode/plate-core';\nimport { withRemoveEmptyNodes } from '@udecode/plate-normalizers';\nimport { Range } from 'slate';\nimport { upsertLinkAtSelection } from './transforms/upsertLinkAtSelection';\nimport { wrapLink } from './transforms/wrapLink';\nimport { ELEMENT_LINK } from './createLinkPlugin';\nimport { LinkPlugin } from './types';\n\nconst upsertLink = <V extends Value>(\n  editor: PlateEditor<V>,\n  {\n    url,\n    at,\n  }: {\n    url: string;\n    at: Range;\n  }\n) => {\n  unwrapNodes(editor, {\n    at,\n    match: { type: getPluginType(editor, ELEMENT_LINK) },\n  });\n\n  const newSelection = editor.selection as Range;\n\n  wrapLink(editor, {\n    at: {\n      ...at,\n      focus: newSelection.focus,\n    },\n    url,\n  });\n};\n\nconst upsertLinkIfValid = <V extends Value>(\n  editor: PlateEditor<V>,\n  { isUrl, getUrlHref }: { isUrl: any; getUrlHref: any }\n) => {\n  const rangeFromBlockStart = getRangeFromBlockStart(editor);\n  const textFromBlockStart = getEditorString(editor, rangeFromBlockStart);\n  const hrefFromBlockStart = getUrlHref?.(textFromBlockStart);\n\n  if (rangeFromBlockStart && isUrl(textFromBlockStart)) {\n    upsertLink(editor, {\n      url: hrefFromBlockStart || textFromBlockStart,\n      at: rangeFromBlockStart,\n    });\n    return true;\n  }\n};\n\n/**\n * Insert space after a url to wrap a link.\n * Lookup from the block start to the cursor to check if there is an url.\n * If not found, lookup before the cursor for a space character to check the url.\n *\n * On insert data:\n * Paste a string inside a link element will edit its children text but not its url.\n *\n */\nexport const withLink = <\n  V extends Value = Value,\n  E extends PlateEditor<V> = PlateEditor<V>\n>(\n  editor: E,\n  {\n    type,\n    options: { isUrl, getUrlHref, rangeBeforeOptions },\n  }: WithPlatePlugin<LinkPlugin, V, E>\n) => {\n  const { insertData, insertText } = editor;\n\n  editor.insertText = (text) => {\n    if (text === ' ' && isCollapsed(editor.selection)) {\n      const selection = editor.selection as Range;\n\n      if (upsertLinkIfValid(editor, { isUrl, getUrlHref })) {\n        moveSelection(editor, { unit: 'offset' });\n        return insertText(text);\n      }\n\n      const beforeWordRange = getRangeBefore(\n        editor,\n        selection,\n        rangeBeforeOptions\n      );\n\n      if (beforeWordRange) {\n        const beforeWordText = getEditorString(editor, beforeWordRange);\n        const beforeWordHref = getUrlHref?.(beforeWordText);\n\n        if (isUrl!(beforeWordText)) {\n          upsertLink(editor, {\n            url: beforeWordHref || beforeWordText,\n            at: beforeWordRange,\n          });\n          moveSelection(editor, { unit: 'offset' });\n        }\n      }\n    }\n\n    insertText(text);\n  };\n\n  editor.insertData = (data: DataTransfer) => {\n    const text = data.getData('text/plain');\n    const textHref = getUrlHref?.(text);\n\n    if (text) {\n      if (isUrl!(text)) {\n        return upsertLinkAtSelection(editor, { url: textHref || text });\n      }\n\n      if (someNode(editor, { match: { type } })) {\n        return insertText(text);\n      }\n    }\n\n    insertData(data);\n  };\n\n  // editor.insertBreak = () => {\n  //   if (upsertLinkIfValid(editor, { link, isUrl })) {\n  //     console.info('fix cursor');\n  //   }\n  //\n  //   insertBreak();\n  // };\n\n  editor = withRemoveEmptyNodes<V, E>(\n    editor,\n    mockPlugin<{}, V, E>({\n      options: { types: type },\n    })\n  );\n\n  return editor;\n};\n","import {\n  createPluginFactory,\n  isUrl as isUrlProtocol,\n} from '@udecode/plate-core';\nimport { onKeyDownLink } from './onKeyDownLink';\nimport { LinkPlugin } from './types';\nimport { withLink } from './withLink';\n\nexport const ELEMENT_LINK = 'a';\n\n/**\n * Enables support for hyperlinks.\n */\nexport const createLinkPlugin = createPluginFactory<LinkPlugin>({\n  key: ELEMENT_LINK,\n  isElement: true,\n  isInline: true,\n  props: ({ element }) => ({ nodeProps: { url: element?.url } }),\n  handlers: {\n    onKeyDown: onKeyDownLink,\n  },\n  withOverrides: withLink,\n  options: {\n    isUrl: isUrlProtocol,\n    rangeBeforeOptions: {\n      matchString: ' ',\n      skipInvalid: true,\n      afterMatch: true,\n    },\n    hotkey: 'mod+k',\n  },\n  then: (editor, { type }) => ({\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: 'A',\n        },\n      ],\n      getNode: (el) => ({\n        type,\n        url: el.getAttribute('href'),\n      }),\n    },\n  }),\n});\n"],"names":["wrapLink","editor","at","url","wrapNodes","type","getPluginType","ELEMENT_LINK","children","split","upsertLinkAtSelection","wrap","selection","isCollapsed","insertNodes","text","linkLeaf","getLeafNode","inlinePath","select","unwrapNodes","match","collapseSelection","edge","getAndUpsertLink","getLinkUrl","prevUrl","linkNode","getAboveNode","window","prompt","shouldWrap","undefined","onKeyDownLink","options","hotkey","e","isHotkey","preventDefault","stopPropagation","upsertLink","newSelection","focus","upsertLinkIfValid","isUrl","getUrlHref","rangeFromBlockStart","getRangeFromBlockStart","textFromBlockStart","getEditorString","hrefFromBlockStart","withLink","rangeBeforeOptions","insertData","insertText","moveSelection","unit","beforeWordRange","getRangeBefore","beforeWordText","beforeWordHref","data","getData","textHref","someNode","withRemoveEmptyNodes","mockPlugin","types","createLinkPlugin","createPluginFactory","key","isElement","isInline","props","element","nodeProps","handlers","onKeyDown","withOverrides","isUrlProtocol","matchString","skipInvalid","afterMatch","then","deserializeHtml","rules","validNodeName","getNode","el","getAttribute"],"mappings":"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"}