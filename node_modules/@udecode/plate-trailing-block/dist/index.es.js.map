{"version":3,"file":"index.es.js","sources":["../src/withTrailingBlock.ts","../src/createTrailingBlockPlugin.ts"],"sourcesContent":["import {\n  ELEMENT_DEFAULT,\n  getLastNodeByLevel,\n  getPluginType,\n  insertElements,\n  PlateEditor,\n  queryNode,\n  Value,\n  WithPlatePlugin,\n} from '@udecode/plate-common';\nimport { Path } from 'slate';\nimport { TrailingBlockPlugin } from './createTrailingBlockPlugin';\n\n/**\n * Add a trailing block when the last node type is not `type` and when the editor has .\n */\nexport const withTrailingBlock = <\n  V extends Value = Value,\n  E extends PlateEditor<V> = PlateEditor<V>\n>(\n  editor: E,\n  {\n    options: { type = getPluginType(editor, ELEMENT_DEFAULT), level, ...query },\n  }: WithPlatePlugin<TrailingBlockPlugin, V, E>\n) => {\n  const { normalizeNode } = editor;\n\n  editor.normalizeNode = ([currentNode, currentPath]) => {\n    if (!currentPath.length) {\n      const lastChild = getLastNodeByLevel(editor, level!);\n\n      const lastChildNode = lastChild?.[0];\n\n      if (\n        !lastChildNode ||\n        (lastChildNode.type !== type && queryNode(lastChild, query))\n      ) {\n        const at = lastChild ? Path.next(lastChild[1]) : [0];\n\n        insertElements(editor, editor.blockFactory({}, at), { at });\n        return;\n      }\n    }\n\n    return normalizeNode([currentNode, currentPath]);\n  };\n\n  return editor;\n};\n","import {\n  createPluginFactory,\n  ELEMENT_DEFAULT,\n  getPluginType,\n  QueryNodeOptions,\n} from '@udecode/plate-common';\nimport { withTrailingBlock } from './withTrailingBlock';\n\nexport interface TrailingBlockPlugin extends QueryNodeOptions {\n  /**\n   * Level where the trailing node should be, the first level being 0.\n   */\n  level?: number;\n\n  /**\n   * Type of the trailing block\n   */\n  type?: string;\n}\n\nexport const KEY_TRAILING_BLOCK = 'trailingBlock';\n\n/**\n * @see {@link withTrailingBlock}\n */\nexport const createTrailingBlockPlugin = createPluginFactory<TrailingBlockPlugin>(\n  {\n    key: KEY_TRAILING_BLOCK,\n    withOverrides: withTrailingBlock,\n    options: {\n      level: 0,\n    },\n    then: (editor) => ({\n      type: getPluginType(editor, ELEMENT_DEFAULT),\n    }),\n  }\n);\n"],"names":["withTrailingBlock","editor","options","type","getPluginType","ELEMENT_DEFAULT","level","query","normalizeNode","currentNode","currentPath","length","lastChild","getLastNodeByLevel","lastChildNode","queryNode","at","Path","next","insertElements","blockFactory","KEY_TRAILING_BLOCK","createTrailingBlockPlugin","createPluginFactory","key","withOverrides","then"],"mappings":";;;AAaA;AACA;AACA;AACaA,MAAAA,iBAAiB,GAAG,CAI/BC,MAJ+B,EAK/B;AACEC,EAAAA,OAAO,EAAE;AAAEC,IAAAA,IAAI,GAAGC,aAAa,CAACH,MAAD,EAASI,eAAT,CAAtB;IAAiDC,KAAjD;IAAwD,GAAGC,KAAAA;AAA3D,GAAA;AADX,CAL+B,KAQ5B;EACH,MAAM;AAAEC,IAAAA,aAAAA;AAAF,GAAA,GAAoBP,MAA1B,CAAA;;EAEAA,MAAM,CAACO,aAAP,GAAuB,CAAC,CAACC,WAAD,EAAcC,WAAd,CAAD,KAAgC;AACrD,IAAA,IAAI,CAACA,WAAW,CAACC,MAAjB,EAAyB;AACvB,MAAA,MAAMC,SAAS,GAAGC,kBAAkB,CAACZ,MAAD,EAASK,KAAT,CAApC,CAAA;MAEA,MAAMQ,aAAa,GAAGF,SAAH,KAAA,IAAA,IAAGA,SAAH,KAAGA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,SAAS,CAAG,CAAH,CAA/B,CAAA;;AAEA,MAAA,IACE,CAACE,aAAD,IACCA,aAAa,CAACX,IAAd,KAAuBA,IAAvB,IAA+BY,SAAS,CAACH,SAAD,EAAYL,KAAZ,CAF3C,EAGE;AACA,QAAA,MAAMS,EAAE,GAAGJ,SAAS,GAAGK,IAAI,CAACC,IAAL,CAAUN,SAAS,CAAC,CAAD,CAAnB,CAAH,GAA6B,CAAC,CAAD,CAAjD,CAAA;QAEAO,cAAc,CAAClB,MAAD,EAASA,MAAM,CAACmB,YAAP,CAAoB,EAApB,EAAwBJ,EAAxB,CAAT,EAAsC;AAAEA,UAAAA,EAAAA;AAAF,SAAtC,CAAd,CAAA;AACA,QAAA,OAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAA,OAAOR,aAAa,CAAC,CAACC,WAAD,EAAcC,WAAd,CAAD,CAApB,CAAA;GAjBF,CAAA;;AAoBA,EAAA,OAAOT,MAAP,CAAA;AACD;;AC5BM,MAAMoB,kBAAkB,GAAG,gBAA3B;AAEP;AACA;AACA;;AACaC,MAAAA,yBAAyB,GAAGC,mBAAmB,CAC1D;AACEC,EAAAA,GAAG,EAAEH,kBADP;AAEEI,EAAAA,aAAa,EAAEzB,iBAFjB;AAGEE,EAAAA,OAAO,EAAE;AACPI,IAAAA,KAAK,EAAE,CAAA;GAJX;EAMEoB,IAAI,EAAGzB,MAAD,KAAa;AACjBE,IAAAA,IAAI,EAAEC,aAAa,CAACH,MAAD,EAASI,eAAT,CAAA;GADf,CAAA;AANR,CAD0D;;;;"}